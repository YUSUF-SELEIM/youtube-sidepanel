(function(){"use strict";let d=!1,o=!1;function c(e){return new URLSearchParams(new URL(e).search).get("v")}function n(e){console.log(`[YouTube SideView] ${e}`)}function u(e=!1){var l,m;const t=document.querySelector("video"),r=window.location.href,i=c(r);if(t&&i){const f=((l=document.querySelector(".title.ytd-video-primary-info-renderer"))==null?void 0:l.textContent)||((m=document.querySelector("h1.title"))==null?void 0:m.textContent)||"YouTube Video";e&&!t.paused&&(n("Pausing original video"),t.pause());const a=t?t.currentTime:0;return n(`Detected video: ${f} (${i}) at ${a}`),chrome.runtime.sendMessage({action:"videoDetected",videoId:i,title:f,url:window.location.href,timestamp:a},p=>{chrome.runtime.lastError?n(`Error sending message: ${chrome.runtime.lastError.message}`):p&&n(`Background responded: ${JSON.stringify(p)}`)}),a}return 0}function g(){const e=document.createElement("div");e.className="yt-sidepanel-notification",e.innerHTML=`
    <div style="position: fixed; top: 20px; right: 20px; background: white; padding: 15px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 9999; width: 300px;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
        <h3 style="margin: 0; font-size: 16px; font-weight: 600;">Watch in Side Panel</h3>
        <button id="close-notification" style="background: none; border: none; cursor: pointer; font-size: 16px;">&times;</button>
      </div>
      <p style="margin: 0 0 10px; font-size: 14px;">Continue watching this video in the side panel while browsing other tabs?</p>
      <div style="display: flex; gap: 10px;">
        <button id="yes-button" style="background: #065fd4; color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer; font-weight: 500;">Yes</button>
        <button id="no-button" style="background: #f2f2f2; color: #0f0f0f; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer; font-weight: 500;">No</button>
      </div>
    </div>
  `,document.body.appendChild(e),document.getElementById("close-notification").addEventListener("click",()=>{e.remove(),o=!1}),document.getElementById("no-button").addEventListener("click",()=>{e.remove(),o=!1}),document.getElementById("yes-button").addEventListener("click",()=>{e.remove(),o=!1,u(!0),chrome.runtime.sendMessage({action:"openSidePanel"},t=>{chrome.runtime.lastError?n(`Error opening side panel: ${chrome.runtime.lastError.message}`):n("Side panel opened")})})}function s(){const e=document.querySelector("video"),t=window.location.href,r=c(t);e&&r&&(u(),!d&&!e.paused&&e.currentTime>0&&!o&&(d=!0,setTimeout(()=>{d&&!o&&(o=!0,g())},2e3)))}setInterval(s,2e3),window.addEventListener("load",()=>{setTimeout(s,2e3)}),window.addEventListener("yt-navigate-finish",()=>{n("YouTube navigation detected"),d=!1,o=!1,setTimeout(s,2e3)}),chrome.runtime.onMessage.addListener((e,t,r)=>{if(e.action==="pauseVideo"){const i=document.querySelector("video");i?(n("Pausing video on request"),i.pause(),r({currentTime:i.currentTime})):r({currentTime:0})}return!0}),n("Content script loaded on: "+window.location.href),setTimeout(s,2e3)})();
