(function(){"use strict";function e(t){console.log(`[YouTube SideView Background] ${t}`)}e("Background script loaded"),chrome.runtime.onMessage.addListener((t,s,o)=>{var c;if(e(`Received message: ${JSON.stringify(t)}`),(t.action==="videoDetected"||t.action==="videoStarted")&&(e(`Storing video info: ${t.title}`),chrome.storage.local.set({currentVideo:{videoId:t.videoId,title:t.title,url:t.url,timestamp:t.timestamp||0,updatedAt:Date.now()}},()=>{chrome.runtime.lastError?e(`Error storing video: ${chrome.runtime.lastError.message}`):e("Video info stored successfully")}),t.action==="videoStarted"&&(chrome.action.setBadgeText({text:"!"}),chrome.action.setBadgeBackgroundColor({color:"#F44336"})),o({success:!0})),t.action==="openSidePanel"){e("Opening side panel");let i=(c=s.tab)==null?void 0:c.id;return i===void 0?(e("Message is from popup, getting current tab"),chrome.tabs.query({active:!0,currentWindow:!0},async n=>{if(n.length>0){const a=n[0];i=a.id;try{a.url.includes("youtube.com/watch")&&(e("Sending pause request to content script"),chrome.tabs.sendMessage(i,{action:"pauseVideo"},function(r){chrome.runtime.lastError?e(`Error pausing video: ${chrome.runtime.lastError.message}`):r&&(e(`Video paused at: ${r.currentTime}`),chrome.storage.local.get(["currentVideo"],d=>{d.currentVideo&&chrome.storage.local.set({currentVideo:{...d.currentVideo,timestamp:r.currentTime}})}))})),chrome.sidePanel.open({tabId:i}).then(()=>{e(`Side panel opened for tab: ${i}`),o({success:!0})}).catch(r=>{e(`Error opening side panel: ${r}`),o({success:!1,error:r.toString()})})}catch(r){e(`Error opening side panel: ${r}`),o({success:!1,error:r.toString()})}}else e("No active tabs found"),o({success:!1,error:"No active tabs found"})})):(e(`Opening side panel for tab: ${i}`),chrome.sidePanel.open({tabId:i}).then(()=>{e("Side panel opened successfully"),o({success:!0})}).catch(n=>{e(`Error opening side panel: ${n}`),o({success:!1,error:n.toString()})})),chrome.action.setBadgeText({text:""}),!0}return!0}),chrome.runtime.onInstalled.addListener(()=>{e("Extension installed/updated"),chrome.sidePanel.setOptions({enabled:!0,path:"src/sidepanel/index.html"}).then(()=>{e("Side panel options set")}).catch(t=>{e(`Error setting side panel options: ${t}`)})})})();
